<div class="container">
    <div class="col-xs-12 dashboard-heading ">
      <h1>Edit Profile</h1>
    </div>
    <div class='row  col-md-6'>
    <form id='edit_form'>
        <div class="form-group row">
          <label for="example-text-input" class="col-xs-2 col-form-label">Name:</label>
          <div class="col-xs-8 input_div input-group">
            <% if @admin == true %>
            <input class="form-control" type="text" value='<%=@student.name%>' name="user[name]" id="example-text-input">
            <span style="display: none" class="input-group-addon"><i>Saved</i></span>
            <span class="hidden"><i>✔</i></span>
            <% else %>
              <input class="form-control" type="text" value='<%=@student.name%>' name="user[name]" id="example-text-input" disabled>
            <% end %>
          </div>
        </div>

        <div class="form-group row"  >
          <label for="text-input-email" class="col-xs-2 col-form-label">Email:</label>
          <div class="col-xs-8 input_div input-group">
              <% if @admin == true %>
            <input  class="form-control" type="text" value='<%=@student.email%>' name="user[email]" id="text-input-email">
            <span style="display: none" class="input-group-addon"><i>Saved</i></span>
            <span class="hidden"><i>✔</i></span>
            <% else %>
        <input disabled  class="form-control" type="text" value='<%=@student.email%>' name="user[email]" id="text-input-email">
            <% end %>
          </div>
        </div>

        <div class="form-group row">
          <label for="text-input-age" class="col-xs-2 has-feedback">Age:</label>
          <div class="col-xs-8 input_div input-group">
            <input class="form-control" type="text" value='<%=@student.age%>' name="user[age]" id="text-input-age">
            <span style="display: none" class="input-group-addon"><i>Saved</i></span>
            <span class="hidden"><i>✔</i></span>

          </div>
        </div>

        <div class="form-group row">
          <label for="text-input-website" class="col-xs-2 col-form-label">Website:</label>
          <div class="col-xs-8 input_div input-group">
            <input class="form-control" type="text" value='<%=@student.website%>' name="user[website]" id="text-input-website">
            <span style="display: none" class="input-group-addon"><i>Saved</i></span>
            <span class="hidden"><i>✔</i></span>

          </div>
        </div>

        <div class="form-group row">
          <label for="text-input-linkedin" class="col-xs-2 col-form-label">LinkedIn:</label>
          <div class="col-xs-8 input_div input-group">
            <input class="form-control" type="text" value='<%=@student.linkedin%>' name="user[linkedin]" id="text-input-linkedin">
            <span style="display: none" class="input-group-addon"><i>Saved</i></span>
            <span class="hidden"><i>✔</i></span>
          </div>
        </div>

        <div class="form-group row">
          <label for="text-input-email" class="col-xs-2 col-form-label">About:</label>
          <div class="col-xs-8 input_div input-group">
            <textarea class="form-control" type="text" value='<%=@student.about%>' name="user[about]" id="text-input-email"><%=@student.about%></textarea>
            <span style="display: none" class="input-group-addon"><i>Saved</i></span>
            <span class="hidden"><i>✔</i></span>
          </div>
        </div>
        </form>
        </div>
        <br>
        <div id='profile_image_div' class='row image-edit-border'>
        <% if @student.avatar_file_name != nil %>
        <div>
        <%= image_tag @student.avatar.url, class: 'profile-img img-responsive img-circle', size:"256" %>
        <% else %>
        <%= image_tag 'profile_pic', title:'click to edit', class: 'profile-img img-responsive img-circle', size:"256" %>
        <p id='edit-icon'>click to edit</p>
        </div>

        <% end %>
        <form id='pic_form' method='post' action='/students/<%=@student.id%>'  enctype="multipart/form-data">
        <div class="form-group row">
        <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
        <input name="user[avatar]" type="file" id="myFile">
    </div>
    </form>
</div>

</div>

<script>
$('#test').click(function () {
    window.location.replace('/students/<%=@student.id%>/edit_pic');
});
$('#myFile').change(function() {
    $('#pic_form').submit()
});


$('#profile_image_div img').click(function(){
        $('#myFile').click()
});


$('#edit_form input, #edit_form textarea').change(function() {
    var c = $(this);
    $.when(c.focusout()).then(function() {
            update_input(c)
    });

});

$('#edit_form input').keypress(function (e) {
    var key = e.which;


    if(key == 13)  // the enter key code
    {
        update_input($(this))
    }
});

function update_input(element) {
    $.ajax({
          method: 'put',
          url: '/students/<%=@student.id%>',
          data: element,
          dataType: 'json',
          success: function(json) {
              $("#myElem").show();
              $(element).siblings("span.input-group-addon").show().delay(800).fadeIn(200, function(){
                  $(element).siblings("span.input-group-addon").hide()
              })
              $(element)
                      .closest('.form-group')
                      .addClass('has-success').delay(800).fadeIn(200, function() {
                          $(element).closest('.form-group').removeClass('has-success')
                      });
              },

             error: function(err) {
                 $(element)
                     .closest('.form-group')
                     .addClass('has-error');

                 window.location.replace('/students/<%=@student.id%>/edit');

              }
        });
    }

    $.ajaxSetup({
  headers: {
    'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
  }
});
</script>
